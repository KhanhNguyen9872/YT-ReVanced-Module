#!/sbin/sh

#################
# Initialization
#################

# Setting umask to 022 
umask 022

# Print a message before loading util_functions
ui_print() { echo "$1"; }

# Function that prints the required Magisk version and exits
require_new_magisk() {
  ui_print "*******************************"
  ui_print " Please install Magisk v20.4+! "
  ui_print "*******************************"
  exit 1
}

#########################
# Load util_functions.sh
#########################

# Create variables for OUTFD, ZIPFILE
OUTFD=$2
ZIPFILE=$3

# Mount /data directory if not already
mount /data 2>/dev/null

# If util_functions.sh does not exist, run require_new_magisk
[ -f /data/adb/magisk/util_functions.sh ] || require_new_magisk

# Source util_functions.sh
. /data/adb/magisk/util_functions.sh

# If Magisk version code is less than 20400, run require_new_magisk
[ $MAGISK_VER_CODE -lt 20400 ] && require_new_magisk

# Install the module
install_module

# Exit script
exit 0